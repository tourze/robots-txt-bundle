# RobotsTxt Bundle (ä¸­æ–‡æ–‡æ¡£)

[English](README.md) | [ä¸­æ–‡](README.zh-CN.md)

[![Latest Version](https://img.shields.io/packagist/v/tourze/robots-txt-bundle.svg?style=flat-square)](
https://packagist.org/packages/tourze/robots-txt-bundle)
[![PHP Version](https://img.shields.io/packagist/php-v/tourze/robots-txt-bundle.svg?style=flat-square)](
https://packagist.org/packages/tourze/robots-txt-bundle)
[![Total Downloads](https://img.shields.io/packagist/dt/tourze/robots-txt-bundle.svg?style=flat-square)](
https://packagist.org/packages/tourze/robots-txt-bundle)
[![License](https://img.shields.io/packagist/l/tourze/robots-txt-bundle.svg?style=flat-square)](LICENSE)
[![Build Status](https://img.shields.io/github/actions/workflow/status/tourze/robots-txt-bundle/ci.yml?style=flat-square)](
https://github.com/tourze/robots-txt-bundle/actions)
[![Code Coverage](https://img.shields.io/codecov/c/github/tourze/robots-txt-bundle?style=flat-square)](
https://codecov.io/gh/tourze/robots-txt-bundle)

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Symfony Bundleï¼Œç”¨äºåŠ¨æ€ç”Ÿæˆå’Œç®¡ç† `robots.txt` æ–‡ä»¶ï¼Œ
æ”¯æŒå¤šæä¾›è€…æ¶æ„ã€‚

## ç›®å½•

- [ç‰¹æ€§](#ç‰¹æ€§)
- [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
- [å®‰è£…](#å®‰è£…)
- [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
- [é…ç½®](#é…ç½®)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ç¤ºä¾‹è¾“å‡º](#ç¤ºä¾‹è¾“å‡º)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
  - [åŸºæœ¬ç”¨æ³•](#åŸºæœ¬ç”¨æ³•)
  - [åˆ›å»ºè‡ªå®šä¹‰æä¾›è€…](#åˆ›å»ºè‡ªå®šä¹‰æä¾›è€…)
- [API å‚è€ƒ](#api-å‚è€ƒ)
  - [RobotsTxtDirective](#robotstxtdirective)
  - [RobotsTxtRule](#robotstxtrule)
  - [RobotsTxtEntry](#robotstxtentry)
- [é«˜çº§ç”¨æ³•](#é«˜çº§ç”¨æ³•)
  - [åŠ¨æ€è§„åˆ™](#åŠ¨æ€è§„åˆ™)
  - [æ¡ä»¶æ€§æä¾›è€…](#æ¡ä»¶æ€§æä¾›è€…)
- [æµ‹è¯•](#æµ‹è¯•)
- [è´¡çŒ®](#è´¡çŒ®)
- [è®¸å¯è¯](#è®¸å¯è¯)

## ç‰¹æ€§

- ğŸ¤– **å®Œæ•´çš„ robots.txt æ”¯æŒ**ï¼šæ”¯æŒæ‰€æœ‰æ ‡å‡†æŒ‡ä»¤
  ï¼ˆUser-agentã€Allowã€Disallowã€Crawl-delayã€Sitemapç­‰ï¼‰
- ğŸ”Œ **å¤šæä¾›è€…æ¶æ„**ï¼šé€šè¿‡å®ç° `RobotsTxtProviderInterface` 
  å¯ä»¥ä»å¤šä¸ªæ¥æºæ”¶é›†è§„åˆ™
- ğŸ¯ **ä¼˜å…ˆçº§æ§åˆ¶**ï¼šæ”¯æŒæä¾›è€…ä¼˜å…ˆçº§ï¼Œçµæ´»æ§åˆ¶è§„åˆ™åˆå¹¶é¡ºåº
- ğŸŒ **ç¯å¢ƒæ”¯æŒ**ï¼šå¯ä»¥æ ¹æ®ä¸åŒç¯å¢ƒæä¾›ä¸åŒçš„ robots.txt å†…å®¹
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šå†…ç½®ç¼“å­˜ç­–ç•¥ï¼Œå‡å°‘æœåŠ¡å™¨è´Ÿè½½
- ğŸ“– **ç¬¦åˆè§„èŒƒ**ï¼šéµå¾ª 
  [Google robots.txt è§„èŒƒ](https://developers.google.com/search/docs/crawling-indexing/robots/robots_txt)
- ğŸ”§ **è‡ªåŠ¨é…ç½®**ï¼šä½¿ç”¨ Symfony çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½è‡ªåŠ¨æ³¨å†Œæä¾›è€…

## æ ¸å¿ƒæ¶æ„

### æ•°æ®æ¨¡å‹

- **RobotsTxtDirective**: å•ä¸ªæŒ‡ä»¤ï¼ˆå¦‚ `Disallow: /admin/`ï¼‰
- **RobotsTxtRule**: é’ˆå¯¹ç‰¹å®š User-agent çš„è§„åˆ™ç»„
- **RobotsTxtEntry**: å®Œæ•´çš„ robots.txt æ¡ç›®

### æä¾›è€…ç³»ç»Ÿ

- **RobotsTxtProviderInterface**: æ ¸å¿ƒæ¥å£ï¼Œå®šä¹‰å†…å®¹æä¾›è€…
- **DefaultRobotsTxtProvider**: é»˜è®¤è§„åˆ™æä¾›è€…

### æœåŠ¡å±‚

- **RobotsTxtService**: æ ¸å¿ƒæœåŠ¡ï¼Œæ”¶é›†å’Œåˆå¹¶æ‰€æœ‰æä¾›è€…çš„å†…å®¹
- **RobotsTxtController**: æ§åˆ¶å™¨ï¼Œå“åº” `/robots.txt` è¯·æ±‚

## å®‰è£…

```bash
composer require tourze/robots-txt-bundle
```

## ç³»ç»Ÿè¦æ±‚

- PHP 8.1 æˆ–æ›´é«˜ç‰ˆæœ¬
- Symfony 6.4 æˆ–æ›´é«˜ç‰ˆæœ¬

## é…ç½®

Bundle å¼€ç®±å³ç”¨ï¼Œåªéœ€è¦æœ€å°é…ç½®ã€‚`/robots.txt` è·¯ç”±ä¼šè‡ªåŠ¨æ³¨å†Œï¼Œ
å¹¶ä»æ‰€æœ‰å·²æ³¨å†Œçš„æä¾›è€…æ”¶é›†å†…å®¹ã€‚

### è‡ªå®šä¹‰é…ç½®

å¦‚æœéœ€è¦è‡ªå®šä¹‰ Bundle è¡Œä¸ºï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶ï¼š

```yaml
# config/packages/robots_txt.yaml
robots_txt:
    cache_enabled: true
    cache_ttl: 3600
```

## å¿«é€Ÿå¼€å§‹

1. å®‰è£… Bundle
2. åˆ›å»ºè‡ªå®šä¹‰æä¾›è€…
3. å®ç° `RobotsTxtProviderInterface`
4. è®¿é—® `/robots.txt`

## ç¤ºä¾‹è¾“å‡º

```text
# Generated by RobotsTxtBundle

User-agent: *
Disallow: /admin/
Disallow: /private/

User-agent: Googlebot
Allow: /api/public/
Crawl-delay: 1

Sitemap: https://example.com/sitemap.xml
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

Bundle ä¼šè‡ªåŠ¨æ³¨å†Œ `/robots.txt` è·¯ç”±ï¼Œè¿”å›ç”Ÿæˆçš„ robots.txt å†…å®¹ã€‚

### åˆ›å»ºè‡ªå®šä¹‰æä¾›è€…

```php
<?php

namespace App\Provider;

use Tourze\RobotsTxtBundle\Provider\RobotsTxtProviderInterface;
use Tourze\RobotsTxtBundle\Model\RobotsTxtEntry;
use Tourze\RobotsTxtBundle\Model\RobotsTxtRule;
use Tourze\RobotsTxtBundle\Model\RobotsTxtDirective;

class CustomRobotsTxtProvider implements RobotsTxtProviderInterface
{
    public function provide(): RobotsTxtEntry
    {
        $entry = new RobotsTxtEntry();

        // æ·»åŠ æ³¨é‡Š
        $entry = $entry->withComment('è‡ªå®šä¹‰ robots.txt è§„åˆ™');

        // ç¦æ­¢æ‰€æœ‰çˆ¬è™«è®¿é—®ç®¡ç†åŒºåŸŸ
        $adminRule = RobotsTxtRule::forAllAgents([
            RobotsTxtDirective::disallow('/admin/'),
            RobotsTxtDirective::disallow('/private/'),
        ]);
        $entry = $entry->withRule($adminRule);

        // ä¸º Googlebot è®¾ç½®ç‰¹æ®Šè§„åˆ™
        $googlebotRule = RobotsTxtRule::forAgent('Googlebot', [
            RobotsTxtDirective::allow('/api/public/'),
            RobotsTxtDirective::crawlDelay(1),
        ]);
        $entry = $entry->withRule($googlebotRule);

        // æ·»åŠ ç«™ç‚¹åœ°å›¾
        $entry = $entry->withSitemap('https://example.com/sitemap.xml');

        return $entry;
    }

    public function getPriority(): int
    {
        return 100; // é«˜ä¼˜å…ˆçº§
    }

    public function supports(): bool
    {
        // åªåœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨
        return ($_ENV['APP_ENV'] ?? 'prod') === 'prod';
    }
}
```

æä¾›è€…ä¼šè‡ªåŠ¨è¢«æ³¨å†Œï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

## API å‚è€ƒ

### RobotsTxtDirective

åˆ›å»ºå•ä¸ª robots.txt æŒ‡ä»¤ï¼š

```php
// Disallow æŒ‡ä»¤
RobotsTxtDirective::disallow('/admin/');

// Allow æŒ‡ä»¤
RobotsTxtDirective::allow('/public/');

// Crawl-delay æŒ‡ä»¤
RobotsTxtDirective::crawlDelay(10);

// Sitemap æŒ‡ä»¤
RobotsTxtDirective::sitemap('https://example.com/sitemap.xml');

// è‡ªå®šä¹‰æŒ‡ä»¤
new RobotsTxtDirective('Custom-directive', 'value');
```

### RobotsTxtRule

åˆ›å»ºé’ˆå¯¹ç‰¹å®š User-agent çš„è§„åˆ™ç»„ï¼š

```php
// é’ˆå¯¹æ‰€æœ‰çˆ¬è™«
RobotsTxtRule::forAllAgents([
    RobotsTxtDirective::disallow('/admin/'),
]);

// é’ˆå¯¹ç‰¹å®šçˆ¬è™«
RobotsTxtRule::forAgent('Googlebot', [
    RobotsTxtDirective::allow('/api/'),
    RobotsTxtDirective::crawlDelay(1),
], 100); // ä¼˜å…ˆçº§
```

### RobotsTxtEntry

å®Œæ•´çš„ robots.txt æ¡ç›®ï¼š

```php
$entry = new RobotsTxtEntry();
$entry = $entry->withComment('ç”Ÿæˆçš„ robots.txt')
               ->withRule($rule)
               ->withSitemap('https://example.com/sitemap.xml');
```

## é«˜çº§ç”¨æ³•

### åŠ¨æ€è§„åˆ™

```php
class DynamicRobotsTxtProvider implements RobotsTxtProviderInterface
{
    public function __construct(
        private UserRepository $userRepository
    ) {}

    public function provide(): RobotsTxtEntry
    {
        $entry = new RobotsTxtEntry();
        
        // æ ¹æ®ç”¨æˆ·æ•°æ®åŠ¨æ€ç”Ÿæˆè§„åˆ™
        $users = $this->userRepository->findPublicUsers();
        foreach ($users as $user) {
            $entry = $entry->withRule(
                RobotsTxtRule::forAllAgents([
                    RobotsTxtDirective::allow("/users/{$user->getId()}/")
                ])
            );
        }

        return $entry;
    }
}
```

### æ¡ä»¶æ€§æä¾›è€…

```php
class ConditionalRobotsTxtProvider implements RobotsTxtProviderInterface
{
    public function supports(): bool
    {
        // åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¯ç”¨
        return $_ENV['ENABLE_SEO'] === 'true' && 
               $_ENV['APP_ENV'] === 'prod';
    }
}
```

## æµ‹è¯•

```bash
./vendor/bin/phpunit packages/robots-txt-bundle/tests
```

## è´¡çŒ®

è¯·æŸ¥çœ‹ [CONTRIBUTING.md](../../CONTRIBUTING.md) äº†è§£å¦‚ä½•ä¸ºæ­¤é¡¹ç›®åšå‡ºè´¡çŒ®ã€‚

## è®¸å¯è¯

MIT License - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

è¯¦ç»†æ–‡æ¡£è¯·å‚è§ [README.md](README.md)ã€‚
